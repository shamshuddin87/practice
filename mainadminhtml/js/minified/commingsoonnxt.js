
var Stats=function(){var l=Date.now(),m=l,g=0,n=Infinity,o=0,h=0,p=Infinity,q=0,r=0,s=0,f=document.createElement("div");f.id="stats";f.addEventListener("mousedown",function(b){b.preventDefault();t(++s%2)},!1);f.style.cssText="width:80px;opacity:0.9;cursor:pointer";var a=document.createElement("div");a.id="fps";a.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";f.appendChild(a);var i=document.createElement("div");i.id="fpsText";i.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";i.innerHTML="FPS";a.appendChild(i);var c=document.createElement("div");c.id="fpsGraph";c.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(a.appendChild(c);74>c.children.length;){var j=document.createElement("span");j.style.cssText="width:1px;height:30px;float:left;background-color:#113";c.appendChild(j)}var d=document.createElement("div");d.id="ms";d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";f.appendChild(d);var k=document.createElement("div");k.id="msText";k.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";k.innerHTML="MS";d.appendChild(k);var e=document.createElement("div");e.id="msGraph";e.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(d.appendChild(e);74>e.children.length;)j=document.createElement("span"),j.style.cssText="width:1px;height:30px;float:left;background-color:#131",e.appendChild(j);var t=function(b){s=b;switch(s){case 0:a.style.display="block";d.style.display="none";break;case 1:a.style.display="none",d.style.display="block"}};return{REVISION:11,domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l;n=Math.min(n,g);o=Math.max(o,g);k.textContent=g+" MS ("+n+"-"+o+")";var a=Math.min(30,30-30*(g/200));e.appendChild(e.firstChild).style.height=a+"px";r++;b>m+1E3&&(h=Math.round(1E3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+" FPS ("+p+"-"+q+")",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=a+"px",m=b,r=0);return b},update:function(){l=this.end()}}};var Bird=function(){function e(e,t,o){c.vertices.push(new THREE.Vector3(e,t,o))}function t(e,t,o){c.faces.push(new THREE.Face3(e,t,o))}var c=this;THREE.Geometry.call(this),e(5,0,0),e(-5,-2,1),e(-5,0,0),e(-5,-2,-1),e(0,2,-6),e(0,2,6),e(2,0,0),e(-3,0,0),t(0,2,1),t(4,7,6),t(5,6,7),this.computeFaceNormals()};Bird.prototype=Object.create(THREE.Geometry.prototype);var Boid=function(){var i,t,o=new THREE.Vector3,s=500,n=500,a=200,e=100,h=4,r=.1,c=!1;this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,i=new THREE.Vector3,this.setGoal=function(i){t=i},this.setAvoidWalls=function(i){c=i},this.setWorldSize=function(i,t,o){s=i,n=t,a=o},this.run=function(t){c&&(o.set(-s,this.position.y,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(s,this.position.y,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,-n,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,n,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,-a),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,a),o=this.avoid(o),o.multiplyScalar(5),i.add(o)),Math.random()>.5&&this.flock(t),this.move()},this.flock=function(o){t&&i.add(this.reach(t,.005)),i.add(this.alignment(o)),i.add(this.cohesion(o)),i.add(this.separation(o))},this.move=function(){this.velocity.add(i);var t=this.velocity.length();t>h&&this.velocity.divideScalar(t/h),this.position.add(this.velocity),i.set(0,0,0)},this.checkBounds=function(){this.position.x>s&&(this.position.x=-s),this.position.x<-s&&(this.position.x=s),this.position.y>n&&(this.position.y=-n),this.position.y<-n&&(this.position.y=n),this.position.z>a&&(this.position.z=-a),this.position.z<-a&&(this.position.z=a)},this.avoid=function(i){var t=new THREE.Vector3;return t.copy(this.position),t.sub(i),t.multiplyScalar(1/this.position.distanceToSquared(i)),t},this.repulse=function(t){var o=this.position.distanceTo(t);if(150>o){var s=new THREE.Vector3;s.subVectors(this.position,t),s.multiplyScalar(.5/o),i.add(s)}},this.reach=function(i,t){var o=new THREE.Vector3;return o.subVectors(i,this.position),o.multiplyScalar(t),o},this.alignment=function(i){for(var t,o=new THREE.Vector3,s=0,n=0,a=i.length;a>n;n++)Math.random()>.6||(t=i[n],distance=t.position.distanceTo(this.position),distance>0&&distance<=e&&(o.add(t.velocity),s++));if(s>0){o.divideScalar(s);var h=o.length();h>r&&o.divideScalar(h/r)}return o},this.cohesion=function(i){for(var t,o,s=new THREE.Vector3,n=new THREE.Vector3,a=0,h=0,c=i.length;c>h;h++)Math.random()>.6||(t=i[h],o=t.position.distanceTo(this.position),o>0&&e>=o&&(s.add(t.position),a++));a>0&&s.divideScalar(a),n.subVectors(s,this.position);var d=n.length();return d>r&&n.divideScalar(d/r),n},this.separation=function(i){for(var t,o,s=new THREE.Vector3,n=new THREE.Vector3,a=0,h=i.length;h>a;a++)Math.random()>.6||(t=i[a],o=t.position.distanceTo(this.position),o>0&&e>=o&&(n.subVectors(this.position,t.position),n.normalize(),n.divideScalar(o),s.add(n)));return s}};function init(){camera=new THREE.PerspectiveCamera(75,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4),camera.position.z=450,scene=new THREE.Scene,birds=[],boids=[];for(var e=0;200>e;e++)boid=boids[e]=new Boid,boid.position.x=400*Math.random()-200,boid.position.y=400*Math.random()-200,boid.position.z=400*Math.random()-200,boid.velocity.x=2*Math.random()-1,boid.velocity.y=2*Math.random()-1,boid.velocity.z=2*Math.random()-1,boid.setAvoidWalls(!0),boid.setWorldSize(500,500,400),bird=birds[e]=new THREE.Mesh(new Bird,new THREE.MeshBasicMaterial({color:16777215*Math.random(),side:THREE.DoubleSide})),bird.phase=Math.floor(62.83*Math.random()),scene.add(bird);renderer=new THREE.CanvasRenderer({alpha:!0}),renderer.setClearColor(16777215,0),renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.body.appendChild(renderer.domElement),stats=new Stats,stats.domElement.style.position="absolute",stats.domElement.style.left="0px",stats.domElement.style.top="0px",document.getElementById("WE-container").appendChild(stats.domElement),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(e){for(var i=new THREE.Vector3(e.clientX-SCREEN_WIDTH_HALF,-e.clientY+SCREEN_HEIGHT_HALF,0),o=0,n=boids.length;n>o;o++)boid=boids[o],i.z=boid.position.z,boid.repulse(i)}function animate(){requestAnimationFrame(animate),render(),stats.update()}function render(){for(var e=0,i=birds.length;i>e;e++)boid=boids[e],boid.run(boids),bird=birds[e],bird.position.copy(boids[e].position),color=bird.material.color,color.r=color.g=color.b=(500-bird.position.z)/1e3,bird.rotation.y=Math.atan2(-boid.velocity.z,boid.velocity.x),bird.rotation.z=Math.asin(boid.velocity.y/boid.velocity.length()),bird.phase=(bird.phase+(Math.max(0,bird.rotation.z)+.1))%62.83,bird.geometry.vertices[5].y=bird.geometry.vertices[4].y=5*Math.sin(bird.phase);renderer.render(scene,camera)}var SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH_HALF=SCREEN_WIDTH/2,SCREEN_HEIGHT_HALF=SCREEN_HEIGHT/2,camera,scene,renderer,birds,bird,boid,boids,stats;init(),animate();;